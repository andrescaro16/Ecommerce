mysql -u root -p

create user "dbuser"@"%" identified with mysql_native_password BY "Eafit2022.";
grant all privileges on ecommerce.* to "dbuser"@"%";
flush privileges;





CREATE DATABASE IF NOT EXISTS ecommerce;

USE ecommerce;



CREATE TABLE IF NOT EXISTS clientes(
	id_cliente INT UNSIGNED  PRIMARY KEY AUTO_INCREMENT NOT NULL,
	nombre VARCHAR (200) NOT NULL,
	email VARCHAR(150) NOT NULL UNIQUE,
	password VARCHAR(64) NOT NULL,
	direccion VARCHAR(200) NOT NULL,
	telefono NUMERIC(13, 0) NOT NULL,
	activo ENUM("inactivo", "activo") NOT NULL DEFAULT "activo",
	creado TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP, 
	modificado TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
)ENGINE=InnoDB;



CREATE TABLE IF NOT EXISTS categorias(
	id_categoria INT UNSIGNED PRIMARY KEY AUTO_INCREMENT NOT NULL,
	nombre VARCHAR(100) NOT NULL
)ENGINE=InnoDB;



CREATE TABLE IF NOT EXISTS productos(
	id_producto INT UNSIGNED PRIMARY KEY AUTO_INCREMENT NOT NULL,
	sku VARCHAR(50) NOT NULL UNIQUE,
	nombre VARCHAR(200) NOT NULL,
	precio DECIMAL(12, 2) NOT NULL,
	descripcion VARCHAR(255) NOT NULL,
	stock INT UNSIGNED NOT NULL,
	id_categoria INT UNSIGNED NOT NULL,
	
	CONSTRAINT productos_fk1 FOREIGN KEY(id_categoria)
			REFERENCES categorias(id_categoria)
			ON UPDATE CASCADE ON DELETE RESTRICT
)ENGINE=InnoDB;



CREATE TABLE IF NOT EXISTS ordenes(
	id_orden INT UNSIGNED PRIMARY KEY AUTO_INCREMENT NOT NULL,
	estado ENUM("carrito", "envio", "entregado") NOT NULL DEFAULT "carrito",
	direccion_entrega VARCHAR(200) NOT NULL, 
	fecha TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
	total DECIMAL(12, 2) NOT NULL,
	id_cliente INT UNSIGNED NOT NULL,
	
	CONSTRAINT ordenes_fk1 FOREIGN KEY(id_cliente)
			REFERENCES clientes(id_cliente)
			ON UPDATE CASCADE ON DELETE RESTRICT
)ENGINE=InnoDB;



CREATE TABLE IF NOT EXISTS orden_detalles(
	id_ordend INT UNSIGNED PRIMARY KEY AUTO_INCREMENT NOT NULL,
	cantidad INT UNSIGNED NOT NULL,
	id_producto INT UNSIGNED NOT NULL,
	id_orden INT UNSIGNED NOT NULL,
	
	CONSTRAINT ordenes_detalles_fk1 FOREIGN KEY(id_producto)
			REFERENCES productos(id_producto)
			ON UPDATE CASCADE ON DELETE RESTRICT,
	CONSTRAINT ordenes_detalles_fk2 FOREIGN KEY(id_orden)
			REFERENCES ordenes(id_orden)
			ON UPDATE CASCADE ON DELETE RESTRICT
)ENGINE=InnoDB;





INSERT INTO clientes(nombre, email, password, direccion, telefono) VALUES
("JOSEP RODRIGUEZ DIAZ", "JRODRIGUEZZ@email.com", "JRODRIGUEZZ", "[6.233457949188366, -75.60414783780772]", 3601306974),
("ALBA HERCE RUBIO", "AHERCER@email.com", "AHERCER", "[6.17683453257968, -75.59198797682318]", 3877799668),
("DANIELA ALONSO ORTEGA", "DALONSOO@email.com", "DALONSOO", "[6.162177256848752, -75.60544789150312]", 3530029050),
("IVAN GUTIERREZ RODRIGUEZ", "IGUTIERREZR@email.com", "IGUTIERREZR", "[6.199410162677247, -75.57515052102147]", 3339218888),
("ISMAEL RAMIREZ CASTILLO", "IRAMIREZC@email.com", "IRAMIREZC", "[6.212362873528258, -75.59467318554775]", 3441140828),
("MARTINA MARTIN PALACIOS", "MMARTINP@email.com", "MMARTINP", "[6.229171673921865, -75.57095707347226]", 3328205644),
("MARIA DOLORES GIL RUBIO", "MDOLORESG@email.com", "MDOLORESG", "[6.262035148822235, -75.58999825471531]", 3146398115),
("JAVIER RODRIGUEZ SANCHEZ", "JRODRIGUEZS@email.com", "JRODRIGUEZS", "[6.3240122320986, -75.5574548248153]", 3574315188),
("BEATRIZ RUIZ SILVA", "BRUIZS@email.com", "BRUIZS", "[6.249510072876535, -75.5838858116853]", 3601667728),
("SOLEDAD HERCE CORDON", "SHERCEC@email.com", "SHERCEC", "[6.26421545052522, -75.56731382424806]", 3676637770);


INSERT INTO categorias(nombre) VALUES
("BELLEZA"),
("CONSTRUCCION"),
("ENTRETENIMIENTO"),
("LIMPIEZA HOGAR"),
("LIMPIEZA PERSONAL"),
("TECNOLOGIA "),
("ARTE"),
("MATERIALES"),
("AUTOMOTRIZ"),
("COMIDA");


INSERT INTO productos(sku, nombre, precio, descripcion, stock, id_categoria) VALUES
("CN329544", "ABARCONES", 10000, "PARA EL HOGAR", 20, 2),
("CN784035", "BARANDILLAS",	20000, "PARA EL HOGAR",	19,	2),
("CN708110", "CERAMICA", 30000, "PARA EL HOGAR", 18, 2),
("CN942935", "BISAGRAS", 40000,	"PARA EL HOGAR", 17, 2),
("BL478789", "CREMA", 10000, "MAQUILLAJE", 16, 1),
("BL235593", "CORRECTOR", 10000, "MAQUILLAJE", 16, 1),
("BL364280", "SECADOR", 70000, "CUIDADO DEL CABELLO", 16, 1),
("BL474794", "CEPILLO",	15000, "CUIDADO DEL CABELLO", 13, 1),
("LP739312", "TRAPEADOR", 10000, "LIMPIEZA HOGAR", 12, 4),
("LP242101", "ESCOBA", 10000, "LIMPIEZA HOGAR",	11,	4),
("LP471266", "GUANTES",	10000, "LIMPIEZA HOGAR", 10, 4),
("LP110271", "BALDE", 10000, "LIMPIEZA HOGAR", 9, 4),
("EN690212", "ROMPECABEZAS", 25000,	"JUEGO", 8,	3),
("AR372549", "OLEOS", 20000, "PINTURA", 7, 7),
("EN737233", "CONSOLA", 1000000, "VIDEOJUEGO", 6, 3),
("AR517037", "PLASTILINA", 5000, "MANUALIDADES", 5, 7),
("TC731716", "TABLET", 900000, "RAPIDA Y EFICAZ", 4, 6),
("TC825067", "COMPUTADORA",	2000000, "BUENOS GRAFICOS",	3, 6),
("TC318161", "CELULAR",	2000000, "ULTIMA GENERACION", 2, 6),
("TC211257", "CARGADOR", 200000, "RESISTENTE AL AGUA", 1, 6);
